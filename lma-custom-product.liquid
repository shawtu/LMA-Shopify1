<!-- /snippets/product.liquid -->

{%- comment -%}
Renders product content

Accepts:
- product: {Object} Current product (required)iframe
- section: {Object} Image to render (required)
- unique: {Object} Section id (required)

Usage:
{%- render 'product' product: product, section: section, unique: unique -%}
{%- endcomment -%}

{%- liquid
assign image_layout = section.settings.image_layout
assign image_width = section.settings.image_width
assign hide_product_thumbnails = section.settings.hide_product_thumbnails | default: false
assign enable_color_swatches = settings.enable_color_swatches_product
assign enable_zoom = section.settings.enable_zoom
assign enable_video_looping = section.settings.enable_video_looping
assign current_variant = product.selected_or_first_available_variant
assign featured_media = current_variant.featured_media | default: product.featured_media
assign featured_media_id = featured_media.id
assign first_3d_model = product.media | where: 'media_type', 'model' | first
assign show_newsletter = settings.show_newsletter

assign image_layout_modifier = image_layout | default: 'carousel'
assign product_wrapper_class = 'product-single__wrapper'
assign product_wrapper_modifiers = ' ' | append: product_wrapper_class | append: '--' | append: image_layout_modifier
assign product_wrapper_modifiers = product_wrapper_modifiers | append: ' ' | append: product_wrapper_class | append: '--' | append: image_width

assign sold_out = true
if current_variant.available
  assign sold_out = false
endif

if product != blank
  assign product_title = product.title | strip_html | escape
  assign product_url = product.url
else
  assign product_title = 'homepage.onboarding.product_title' | t
  assign product_url = '#!'
endif

if product.media.size < 2 and section_type == 'featured'
  assign hide_product_thumbnails = true
endif

assign animations_enabled = settings.animations_enabled
assign animation_anchor = '#FeaturedProduct--' | append: unique
assign animation_delay = 150

comment
  Quick View related settings
endcomment
if section_type == 'quickview'
  assign animations_enabled = false
  assign hide_product_thumbnails = true
  assign show_labels = settings.show_labels
  assign show_quantity = settings.show_quantity
  assign show_payment_button = settings.show_payment_button
  assign show_remaining = settings.show_remaining
  assign enable_subscriptions_selectors = settings.enable_subscriptions_selectors
  assign enable_video_looping = settings.enable_video_looping
endif

assign hide_labels_class = ''
unless show_labels
  assign hide_labels_class = ' variant__labels--hide'
endunless
-%}

{%- capture product_gallery -%}
{%- unless product == blank -%}
  <div class="product-single__gallery lma-custom-gallery"
    id="ProductPhoto--{{ unique }}"
    data-gallery="{{ enable_zoom }}"
    data-autoplay-video="false"
    data-product-single-media-group
    {% if animations_enabled %}
      data-aos="fade"
      data-aos-anchor="{{ animation_anchor }}"
      data-aos-delay="{{ animation_delay }}"
      {%- assign animation_delay = animation_delay | plus: 150 -%}
    {% endif %}>
    <div class="product-single__media-slider{% if product.media.size == 1 %} product-single__media-slider--single{% endif %}" data-product-single-media-slider>
      {%- if product.media.size > 0 -%}
        {%- comment -%} Show Featured media first {%- endcomment -%}
        {%- render 'media', unique: unique, current_variant: current_variant, media: featured_media, featured_media: featured_media, enable_video_looping: enable_video_looping, enable_zoom: enable_zoom, section_type: section_type -%}

        {%- comment -%} Loop product media skipping the featured {%- endcomment -%}
        {%- for media in product.media -%}
          {%- if media.id != featured_media_id -%}
            {%- render 'media', unique: unique, current_variant: current_variant, media: media, featured_media: featured_media, enable_video_looping: enable_video_looping, enable_zoom: enable_zoom, section_type: section_type -%}
          {%- endif -%}
        {%- endfor -%}
      {%- else -%}
        {%- assign media_aspect_ratio = 1 -%}
        {%- assign media_padding_top = 1 | divided_by: media_aspect_ratio | times: 100 | round: 1 -%}
        {%- assign image_url_pattern = product.featured_image | img_url: '1000x' | replace: '_1000x.', '_{width}x.' -%}
        {%- assign image_widths = "[180, 360, 540, 720, 900, 1080, 1296, 1512, 1728, 2048, 2450, 2700, 3000, 3350, 3750, 4100]" -%}

        <div
          id="FeaturedMedia-{{ unique }}"
          class="product-single__media-slide{% unless featured_media == media %} media--hidden{% endunless %}"
          data-id="{{ unique }}"
          data-media-id="{{ unique }}"
          data-aspectratio="{{ media_aspect_ratio }}"
          data-product-single-media-wrapper>
          <div class="product-single__media product-single__media--image">
            <div class="product-single__media--image-height" style="padding-top: {{ media_padding_top }}%;"></div>
            <img class="lazyload"
              src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
              data-src="{{ image_url_pattern }}"
              data-widths= "{{ image_widths }}"
              data-aspectratio="{{ media_aspect_ratio }}"
              data-sizes="auto"
              data-object-fit="contain"
              alt="{{ product.title | strip_html | escape }}">
            <noscript>
              <img src="{{ product.featured_image | img_url: '1024x' }}" alt="{{ product.title | strip_html | escape }}">
            </noscript>
          </div>
        </div>
      {%- endif -%}
    </div>
    {%- comment -%} Product Thumbnails {%- endcomment -%}
    {%- if product.media.size > 1 and hide_product_thumbnails == false -%}
      
      {%- render 'lma-custom-products-thumbs',  product: product, 
  featured_media: featured_media, 
  featured_media_id: featured_media.id, 
  has_link: true, 
  product_title: product.title  -%}
      
    {%- endif -%}
  </div>
{%- else -%}
  {%- comment -%} Onboarding product media {%- endcomment -%}
  <div id="ProductPhoto--{{ unique }}"
    class="featured-product__gallery"
    {% if animations_enabled %}
      data-aos="fade"
      data-aos-anchor="{{ animation_anchor }}"
      data-aos-delay="{{ animation_delay }}"
      {%- assign animation_delay = animation_delay | plus: 150 -%}
    {% endif %}>
    <div class="featured-product__gallery__slider product-single__media-slider" data-product-single-media-slider>
      <div class="product-single__media-slide">
        <div class="product-single__media product-single__media--onboarding">
          {{- 'product-5' | placeholder_svg_tag: 'placeholder-svg' -}}
        </div>
      </div>
    </div>
  </div>
{%- endunless -%}
{%- endcapture -%}

{%- unless section_type == 'quickview' -%}
<div class="{{ product_wrapper_class }}{{ product_wrapper_modifiers }}" data-section-id="{{ unique }}" data-product>
  {%- comment -%} Product media {%- endcomment -%}
  {{ product_gallery }}

  {%- comment -%} Accordions {%- endcomment -%}
  <div class="product-single__details lma-single-description" data-collapsible-single>
    <div class="form__wrapper" data-product-info>
      {%- for block in section.blocks -%}
        {%- liquid
          assign padding_bottom = block.settings.padding_bottom

          if padding_bottom != blank
            capture block_style
              echo 'style="--PBB:' | append: padding_bottom | append: 'px;"'
            endcapture
          endif
        -%}

        {%- case block.type -%}
          {%- when '@app' -%}
            {%- capture app_code -%}
              {%- render block -%}
            {%- endcapture -%}

            {% capture animations_attributes %}
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
            {% endcapture %}

            {%- comment -%} Display app in tabs if it contains reviews {%- endcomment -%}
            {%- if app_code contains '<div id="shopify-product-reviews" data-id=' -%}
              <div
                class="product__block product__accordions"
                {{ block_style }}
                {{ animations_attributes }}
                {{ block.shopify_attributes }}
              >
                <div class="product__accordion" id="ProductAccordion--reviews-container">
                  <button
                    class="product__accordion__title"
                    aria-controls="ProductAccordion--{{ section.id }}-{{ block.id }}"
                    data-collapsible-trigger
                  >
                    {{- 'products.general.reviews' | t -}}
                    {%- render 'icon-toggle-plus' -%}
                    {%- render 'icon-toggle-minus' -%}
                  </button>
                  <div
                    class="product__accordion__content"
                    id="ProductAccordion--{{ section.id }}-{{ block.id }}"
                    data-collapsible-container
                  >
                    <div class="product__accordion__inner" data-collapsible-content>
                      <div class="product__reviews">
                        {{ app_code }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {%- else -%}
              <div class="product__block standard__app" {{ animations_attributes }} {{ block.shopify_attributes }}>
                {{ app_code }}
              </div>
            {%- endif -%}

          {%- when 'title' -%}
            <div
              class="product__block product__title-and-price"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block.shopify_attributes }}
            >
              {%- case block.settings.subheading -%}
                {%- when 'breadcrumbs' -%}
                  {%- render 'breadcrumbs' -%}

                {%- when 'collection' -%}
                  {%- if collection or product.collections.size > 0 -%}
                    {%- assign collection = collection | default: product.collections[0] -%}

                    <nav class="breadcrumbs">
                      <a href="{{ collection.url }}" title="{{ collection.title | strip_html | escape }}">
                        {{- collection.title -}}
                      </a>
                    </nav>
                  {%- endif -%}

                {%- when 'vendor' -%}
                  {%- unless product == blank -%}
                    {%- assign vendor = product.vendor -%}
                  {%- else -%}
                    {%- assign vendor = 'homepage.onboarding.vendor' | t -%}
                  {%- endunless -%}

                  <nav class="breadcrumbs">
                    <a href="{{ vendor | url_for_vendor }}">{{ vendor }}</a>
                  </nav>
              {%- endcase -%}

              <h1 class="product__title">
                {%- if template.name == 'product' and section_type != 'featured' -%}
                  {{- product_title -}}
                {%- else -%}
                  <a href="{{ product_url }}" title="{{ product_title }}">{{ product_title }}</a>
                {%- endif -%}
              </h1>
            </div>

            {%- assign currency_code_enable = settings.currency_code_enable -%}

            <div
              class="product__block product__price-and-badge"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
            >
              <div class="product__price" data-price-wrapper>
                {%- unless product == blank -%}
                  <span
                    data-product-price
                    class="product__price--regular{% if current_variant.compare_at_price > current_variant.price %} product__price--sale{% endif %}"
                  >
                    {%- liquid
                      if current_variant.price == 0
                        echo 'products.product.free' | t
                      elsif currency_code_enable
                        echo current_variant.price | money_with_currency
                      else
                        echo current_variant.price | money
                      endif
                    -%}
                  </span>
                {%- else -%}
                  <span id="ProductPrice">
                    {%- liquid
                      if currency_code_enable
                        echo 1999 | money_with_currency
                      else
                        echo 1999 | money
                      endif
                    -%}
                  </span>
                {%- endunless -%}

                <s data-compare-price class="product__price--compare">
                  {%- liquid
                    if current_variant.compare_at_price
                      if currency_code_enable
                        echo current_variant.compare_at_price | money_with_currency
                      else
                        echo current_variant.compare_at_price | money
                      endif
                    endif
                  -%}
                </s>

                {%- liquid
                  assign units = product.variants | map: 'unit_price' | compact
                  if units[0]
                    assign has_units = true
                  else
                    assign has_units = false
                  endif
                -%}

                {%- if has_units -%}
                  {%- assign current_variant_unit_price = current_variant.unit_price -%}
                  {%- capture show_units -%}
      {%- unless current_variant_unit_price -%}style="display: none;"{%- endunless -%}
    {%- endcapture -%}

                  {%- capture unit_price_separator -%}
      <span aria-hidden="true">/</span><span class="visually-hidden">{{ 'general.accessibility.unit_price_separator' | t }}&nbsp;</span>
    {%- endcapture -%}

                  {%- capture unit_price_base_unit -%}
      <span>
        {%- if current_variant.unit_price_measurement -%}
          {% if current_variant.unit_price_measurement.reference_value != 1 %}
            {{ current_variant.unit_price_measurement.reference_value }}
          {% endif %}
          {{ current_variant.unit_price_measurement.reference_unit }}
        {%- endif -%}
      </span>
    {%- endcapture -%}

                  <span class="product__unit-price">
                    <span
                      data-product-unit
                      class="product__price--unit{% unless current_variant_unit_price %} hidden{% endunless %}"
                    >
                      <span class="visually-hidden">{{ 'products.product.unit_price_label' | t }}</span>
                      <span data-product-unit-price id="unit-price-{{ section.id }}">
                        {{- current_variant_unit_price | money -}}
                      </span>
                      {{ unit_price_separator }}
                      <span data-product-base id="unit-price-base-{{ section.id }}">{{ unit_price_base_unit }}</span>
                    </span>
                  </span>
                {%- endif -%}

                <span data-price-off class="product__price--off hidden">
                  <span data-price-off-type>{{ 'products.product.sale' | t }}</span>
                  <em>â€¢</em>
                  {{ 'products.product.save' | t }}
                  <span data-price-off-amount></span>
                </span>
              </div>

              {%- if block.settings.show_rating or settings.show_rating and section_type == 'quickview' -%}
                {%- unless product == blank -%}
                  {%- render 'rating',
                    show_rating_count: block.settings.show_rating_count,
                    single_star: true,
                    reviews: product.metafields.reviews
                  -%}
                {%- else -%}
                  {%- render 'rating',
                    show_rating_count: block.settings.show_rating_count,
                    single_star: true,
                    onboarding: true
                  -%}
                {%- endunless -%}
              {%- endif -%}
            </div>

          {%- when 'form' -%}
            {%- liquid
              assign show_quantity = false
              if product.metafields.custom.quantity.value == true
                assign show_quantity = true
              endif
              assign show_payment_button = block.settings.show_payment_button
              assign enable_subscriptions_selectors = block.settings.enable_subscriptions_selectors
              assign hide_labels_class = ''
              assign show_labels = block.settings.show_labels
              unless show_labels
                assign hide_labels_class = ' variant__labels--hide'
              endunless
            -%}

            {%- unless product == blank -%}
              <div
                class="product__block product__form__wrapper{{ hide_labels_class }}{% if sold_out %} variant--soldout{% endif %}"
                data-form-wrapper
                {{ block_style }}
                {{ block.shopify_attributes }}
              >
                {%- comment -%} Product Form Partial {%- endcomment -%}
                <!-- /partials/product-form.liquid -->

                {%- liquid
                  assign current_variant = product.selected_or_first_available_variant
                  assign unique = unique | default: ''
                  assign variants_style = settings.variants_style

                  comment
                    Override buy button setting if there are selling plan groups and cart terms
                  endcomment
                  if show_payment_button and product.selling_plan_groups.size < 1 and settings.enable_accept_terms == false
                    assign show_payment_button = true
                  else
                    assign show_payment_button = false
                  endif

                  assign product_form_id = 'AddToCartForm--' | append: unique

                  comment
                    Size chart
                  endcomment
                  assign show_size_chart = false
                  assign tags_string = product.tags | join: ','
                  assign size_separator = '_size_'
                  assign specific_pages = ''

                  if tags_string contains size_separator
                    for tag in product.tags
                      if tag contains size_separator
                        assign page_handle = tag | split: size_separator | last | split: ',' | first
                        assign specific_pages = specific_pages | append: page_handle | append: ','
                      endif
                    endfor
                  endif

                  if block.settings.info_page != blank
                    assign info_page = pages[block.settings.info_page]
                    assign info_page_title_override = block.settings.info_page_title_override
                    assign size_translation = 'general.size_chart.size' | t
                    assign size_translation = size_translation | lstrip | rstrip | downcase
                    assign show_size_link_as_label = false

                    for option in product.options
                      assign option_san = option | lstrip | rstrip | downcase

                      if option_san contains size_translation and show_labels
                        assign show_size_link_as_label = true
                      endif
                    endfor
                  endif
                -%}

                {%- if info_page != blank or specific_pages != '' -%}
                  {%- assign show_size_chart = true -%}
                  {%- assign specific_pages_arr = specific_pages | split: ',' -%}

                  {%- capture size_chart_button -%}
  <button type="button" class="product__popup__link" href="{{ info_page.url }}" aria-controls="size-chart--{{ section.id }}" data-drawer-toggle>
    {%- unless info_page_title_override != blank-%}
      {%- if pages[specific_pages_arr[0]].title != blank -%}
        {{ pages[specific_pages_arr[0]].title }}
      {%- else -%}
        {{ info_page.title }}
      {%- endif -%}
    {%- else -%}
      {{ info_page_title_override }}
    {%- endunless -%}
    {% render 'icon-ruler' %}
  </button>
{%- endcapture -%}

                  {%- capture size_chart_modal -%}
  <div class="product__popup drawer drawer--left" id="size-chart--{{ section.id }}" aria-hidden="true" role="dialog" data-drawer>
    <button type="button" class="drawer__close-button" aria-controls="size-chart--{{ section.id }}" data-drawer-toggle>
      <span class="visually-hidden">{{ 'general.accessibility.close_drawer' | t }}</span>
      {%- render 'icon-close' -%}
    </button>

    <div class="product__popup__inner" data-scroll>
      <div class="product__popup__content">
        <div class="rte product__tabs" data-tabs-holder>
          {%- liquid
            assign tabs_navigation = ''
            assign tabs = ''
            assign has_current = false
            assign index = 0
          -%}

          {%- for page_handle in specific_pages_arr -%}
            {%- assign page_size_chart = pages[page_handle] -%}

            {%- if page_size_chart.title != blank -%}
              {%- capture tabs_navigation -%}
                {{ tabs_navigation }}

                <li class="tab__link" data-focus-element data-tab-link="{{ forloop.index0 }}" tabindex="0">{{ page_size_chart.title }}</li>
              {%- endcapture -%}

              {%- capture tabs -%}
                {{ tabs }}

                <div class="tab__content{% unless has_current %} current{% endunless %}" data-tab-content="{{ forloop.index0 }}">
                  {{ page_size_chart.content }}
                </div>
              {%- endcapture -%}

              {%- assign has_current = true -%}
            {%- endif -%}
          {%- endfor -%}

          {%- if info_page -%}
            {%- assign index = specific_pages_arr.size -%}

            {%- capture tabs_navigation -%}
              {{ tabs_navigation }}

              <li class="tab__link" data-focus-element data-tab-link="{{ index }}" data-lock-scroll tabindex="0">{{ info_page.title }}
              </li>
            {%- endcapture -%}

            {%- capture tabs -%}
              {{ tabs }}

              <div class="tab__content{% unless has_current %} current{% endunless %}" data-tab-content="{{ index }}">
                {{ info_page.content }}
              </div>
            {%- endcapture -%}

            {%- assign has_current = true -%}
          {%- endif -%}

          {%- if specific_pages_arr.size > 1 -%}
            <div class="tabs__head product__tabs__head">
              <ul class="tabs product__tabs__title" data-scrollbar data-scrollbar-slider>
                {{ tabs_navigation }}
              </ul>

              <button type="button" class="tabs__arrow tabs__arrow--prev tabs-collections__arrow tabs-collections__arrow--prev is-hidden" data-scrollbar-arrow-prev>
                <span class="visually-hidden">{{ 'products.general.see_all' | t }}</span>
              </button>

              <button type="button" class="tabs__arrow tabs__arrow--next tabs-collections__arrow tabs-collections__arrow--next is-hidden" data-scrollbar-arrow-next>
                <span class="visually-hidden">{{ 'products.general.see_all' | t }}</span>
              </button>
            </div>
          {%- endif -%}

          {%- if tabs != '' -%}
            {{ tabs }}
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>
{%- endcapture -%}

                {%- endif -%}

                {% assign shipping_message = block.settings.delivery_text %}
                {% assign availability_message = block.settings.availability_message %}
                {% assign delivery_image = block.settings.delivery_image %}

                {%- form 'product', product, class: 'product__form', data-product-form: '', id: product_form_id -%}
                  {% comment %} The input with name="id" submits to cart {% endcomment %}
                  <input type="hidden" name="id" value="{{ current_variant.id }}" data-product-select>


                  {%- unless show_size_link_as_label or size_chart_button == blank -%}
                    <div
                      class="product__form__size-chart"
                      {% if animations_enabled %}
                        data-aos="fade-up"
                        data-aos-anchor="{{ animation_anchor }}"
                        data-aos-delay="{{ animation_delay }}"
                        {%- assign animation_delay = animation_delay | plus: 100 -%}
                      {% endif %}
                    >
                      {{- size_chart_button -}}
                    </div>
                  {%- endunless -%}

                  {%- assign quantity_position_bottom = true -%}
                  {%- unless show_quantity -%}
                    <input type="hidden" name="quantity" value="1">
                  {%- endunless -%}

                  {%- capture quantity_selector -%}
                  <div class="select__fieldset">
                    <span class="select__label" id="{{ unique }}-select-quantity-label">{{ 'products.product.quantity' | t }}</span>
              
                    <div class="select-popout select-popout--small select-popout--alt" data-popout data-popout-prevent="true">
                      <button type="button" class="select-popout__toggle{% if variants_style == 'boxes' %} select-popout__toggle--qty{% endif %}" aria-expanded="false" aria-controls="{{ unique }}-select-quantity" aria-labelledby="{{ unique }}-select-quantity-label" data-popout-toggle data-popout-quantity>
                        <span class="select-popout__value" data-popout-text data-quantity-select>1</span>
                        {%- render 'icon-select' -%}
                      </button>
              
                      <div id="{{ unique }}-select-quantity" class="select-popout__list" data-popout-list>
                        <ul class="select-popout__list__scroll">
                          {%- for idx in (1..10) -%}
                            <li class="select-popout__item{% if forloop.index == 1 %} select-popout__item--current{% endif %}">
                              <a class="select-popout__option" href="#" {% if forloop.index == 1 %}aria-current="true"{% endif %} data-value="{{ forloop.index }}" data-popout-option>
                                <span>{{ forloop.index }} {% if forloop.last %}+{% endif %}</span>
                              </a>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </div>
              
                      <div class="quantity-selector" data-quantity-holder>
                        <label for="product-quantity-buttons-{{ section.id }}" class="label-hidden">{{ 'products.product.quantity' | t }}</label>
              
                        <button type="button" class="quantity__btn quantity__btn--decrease" data-quantity-minus data-quantity-button tabindex="0" title="{{ 'general.accessibility.decrease' | t }} - {{ product.title | strip_html -}}">
                          <span class="visually-hidden">{{ 'general.accessibility.decrease' | t }}</span>
                          {%- render 'icon-toggle-minus' -%}
                        </button>
              
                        <input id="product-quantity-buttons-{{ section.id }}" data-popout-input type="number" class="quantity__selector quantity__input" value="1" min="1" aria-label="quantity" autocomplete="off" name="quantity" data-quantity-field title="{{- 'products.product.quantity' | t }} - {{ product.title | strip_html -}}" pattern="[0-9]*" />
              
                        <button type="button" class="quantity__btn quantity__btn--increase" data-quantity-plus data-quantity-button tabindex="0" title="{{- 'general.accessibility.increase' | t }} - {{ product.title | strip_html -}}">
                          <span class="visually-hidden">{{ 'general.accessibility.increase' | t }}</span>
                          {%- render 'icon-toggle-plus' -%}
                        </button>
                      </div>
                    </div>
                  </div>
                {%- endcapture -%}

                  {%- capture form_fields -%}
                  {%- unless product.has_only_default_variant -%}
                    {%- assign selects_counter = 0 -%}
                    <div class="product__selectors">
                      {%- for option in product.options_with_values -%}
                        {%- comment -%} Use select over radio for long inputs and mismatched lengths {%- endcomment -%}
              
                        {%- assign option_name_handle_separator = option.name | handle | prepend: ',' | append: ',' -%}
                        {%- assign enable_color_swatches = settings.enable_color_swatches_product -%}
              
                        {%- liquid
                if enable_color_swatches
                  comment
                    Determine if current option matches swatch handle translations
                  endcomment
                  assign is_swatch_option = false
                  assign swatch_translation = 'general.swatches.color' | t
                  assign translation_string = swatch_translation | remove: '  ' | replace: ', ', ',' | replace: ' ,', ',' | replace: ',', '____' | handle | replace: '____', ',' | append: ',' | prepend: ','
              
                  if translation_string contains option_name_handle_separator
                    assign is_swatch_option = true
                  endif
                endif
              -%}

        {%- liquid
          assign is_size_option = false

          if info_page and is_size_option == false

            comment
              Determine if current option matches size handle translations
            endcomment
            assign option_name = option.name | lstrip | rstrip | downcase
            assign size_translation = 'general.size_chart.size' | t
            assign translation_string = size_translation | remove: '  ' | replace: ', ', ',' | replace: ' ,', ',' | replace: ',', '____' | handle | replace: '____', ',' | append: ',' | prepend: ','

            if translation_string contains option_name
              assign is_size_option = true
            endif
          endif

          assign longest_value = 0
          assign shortest_value = 100
          for value in option.values
            if value.size > longest_value
              assign longest_value = value.size
            endif

            if value.size < shortest_value
              assign shortest_value = value.size
            endif
          endfor

          assign flexible = true
          assign chars_diff = longest_value | minus: shortest_value
          if chars_diff < 5 and longest_value < 6
            assign flexible = false
          endif

          assign enable_variant_boxes = false
          if variants_style == 'boxes' or variants_style == 'auto' and longest_value < 16
            assign enable_variant_boxes = true
          endif

          capture selector_wrapper_class
            echo 'selector-wrapper'
            if enable_variant_boxes
              echo ' selector-wrapper--boxes'

              unless flexible or is_swatch_option
                echo ' selector-wrapper--grid'
              endunless
            endif

            if is_swatch_option
              echo ' selector-wrapper--swatches'
            endif
          endcapture
        -%}

        
        <div class="{{ selector_wrapper_class }}"
          data-option-position="{{ option.position }}"
          {% if animations_enabled %}
            data-aos="fade-up"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-delay="{{ animation_delay }}"
            {%- assign animation_delay = animation_delay | plus: 100 -%}
          {% endif %}>
          {%- if enable_variant_boxes or is_swatch_option -%}
            {%- assign current_value = current_variant.options[forloop.index0] -%}
            <fieldset class="radio__fieldset radio__fieldset--{{ settings.color_swatches_product_style }}">
              <legend class="radio__legend{% if is_size_option and info_page != blank %} radio__legend--flex radio__legend--size-chart{% endif %}">
                {%- if is_size_option and show_labels and info_page != blank -%}
                  {{- size_chart_button -}}
                {%- else -%}
                  <span class="radio__legend__label h6 strong">{{ option.name | escape_once }}</span>
                {%- endif -%}
              </legend>
              {%- for value in option.values -%}
                {%- capture input_id -%}{{ product.id }}-{{ option.name | escape_once }}-{{ value | escape_once }}{%- endcapture -%}

                {%- if is_swatch_option -%}
                  <span class="swatch__button swatch__button--{{ settings.color_swatches_product_style }}" data-tooltip="{{ value | escape_once | capitalize }}">
                    <input type="radio"
                      class="swatch__input"
                      data-single-option-selector
                      data-index="option{{ option.position }}"
                      name="options[{{ option.name | escape_once }}]"
                      value="{{ value | escape_once }}"
                      id="{{ input_id }}"
                      {% if value == current_value %}checked{% endif %}>
                    <label for="{{ input_id }}" class="swatch__label" data-swatch="{{ value | escape_once }}" data-tooltip="{{ value | escape_once }}">
                      <span class="visually-hidden">{{ value | escape_once }}</span>
                      {%- if settings.color_swatches_product_style == 'circle' -%}
                        <span class="icon icon-check"></span>
                      {%- endif -%}
                    </label>
                  </span>
                {%- else -%}
                  {% comment %} radio button {% endcomment %}
                  <span class="radio__button">
                    <input
                      type="radio"
                      class="radio__input"
                      data-single-option-selector
                      data-index="option{{ option.position }}"
                      name="options[{{ option.name | escape_once }}]"
                      value="{{ value | escape_once }}" id="{{ input_id }}"
                      {% if value == current_value %}checked{% endif %}>
                    <label for="{{ input_id }}" class="radio__label">
                      <span>{{ value | escape_once }}</span>
                    </label>
                  </span>
                {%- endif -%}

              {%- endfor -%}
            </fieldset>
          {%- else -%}
            {%- assign selects_counter = selects_counter | plus: 1 -%}
            <div class="select__fieldset">
              {%- capture input_id -%}{{ product.id }}-option-{{ option.position }}{%- endcapture -%}
              <div class="select__label" id="{{ unique }}-select-{{ option.name | handle }}-label">
                {%- if is_size_option and show_labels and info_page != blank -%}
                  <div class="select__label__dot">&nbsp;</div>
                  {{- size_chart_button -}}
                {%- else -%}
                  {{- option.name | escape_once -}}
                {%- endif -%}
              </div>

              <div class="select-popout" data-popout data-popout-prevent="true">
                <button type="button" class="select-popout__toggle" aria-expanded="false" aria-controls="{{ unique }}-select-{{ option.name | handle }}" aria-labelledby="{{ unique }}-select-{{ option.name | handle }}-label" data-popout-toggle>
                  <span class="select-popout__value" data-popout-text>{{ option.selected_value }}</span>
                  {%- render 'icon-select' -%}
                </button>

                <div id="{{ unique }}-select-{{ option.name | handle }}" class="select-popout__list" data-popout-list>
                  <ul class="select-popout__list__scroll">
                    {%- for value in option.values -%}
                      <li class="select-popout__item {% if option.selected_value == value %}select-popout__item--current{% endif %}">
                        <a class="select-popout__option" href="#" {% if option.selected_value == value %}aria-current="true"{% endif %} data-value="{{ value | escape_once }}" data-popout-option>
                          <span>
                            {{ value | escape_once }}
                          </span>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
                <input type="hidden" name="options[{{ option.name | escape_once }}]" id="{{ input_id }}" value="{{ option.selected_value | escape_once }}" data-popout-input data-single-option-selector data-index="option{{ option.position }}"/>
              </div>
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  {%- endunless -%}
{%- endcapture -%}

                  {{- form_fields -}}

                  <noscript>
                    <select
                      name="id"
                      class="product__form__select"
                      aria-label="{{ product.options_with_values | map: 'name' | uniq | join: ', ' }}"
                    >
                      {%- for variant in product.variants -%}
                        <option
                          {% if variant == current_variant %}
                            selected="selected"
                          {% endif %}
                          {% unless variant.available %}
                            disabled="disabled"
                          {% endunless %}
                          value="{{ variant.id }}"
                        >
                          {{- variant.title -}}
                        </option>
                      {%- endfor -%}
                    </select>
                  </noscript>

                  {%- if product.selling_plan_groups.size > 0 -%}
                    {%- if enable_subscriptions_selectors -%}
                      {%- render 'subscription-form',
                        product: product,
                        animations_enabled: animations_enabled,
                        animation_anchor: animation_anchor,
                        animation_delay: animation_delay
                      -%}
                    {%- endif -%}
                    {%- assign animation_delay = animation_delay | plus: 100 -%}
                    {%- comment -%} Delete the following line to block the theme from updating subscription prices {%- endcomment -%}
                    <span data-subscription-watch-price></span>
                  {%- endif -%}

                  {%- assign sold_out_text = 'products.product.sold_out' | t -%}
                  {%- if show_newsletter -%}
                    {%- assign newsletter_text = 'general.newsletter_form.newsletter_product_availability' | t -%}
                    {%- assign sold_out_text = newsletter_text -%}
                  {%- endif -%}

                  {%- assign request_quote = false -%}

                  {%- if product.tags contains 'Request Quote' -%}
                    {%- assign request_quote = true -%}
                  {%- endif -%}

                  {%- assign specialOffer = false -%}

                  {%- if product.tags contains 'Special Order' -%}
                    {%- assign specialOffer = true -%}
                  {%- endif -%}

                  {% liquid
                    assign is_current_variant_available = false
                    if current_variant.inventory_quantity > 0
                      assign is_current_variant_available = true
                    endif
                  %}

                  <div
                    id="lma__submit__holder"
                    class="product__submit__holder{% if show_payment_button %} product__submit__holder--spb{% endif %}{% if show_newsletter %} product__submit__holder--notification{% endif %} {% if quantity_position_bottom and show_quantity %} variant_enabled {% endif %}"
                    data-product-id="{{ product.id }}"
                  >
                    {% comment %}
                      <div class="lma_shop_pay small"><p>From <strong>$XXX.XX</strong> / mo with</p><img src="https://cdn.shopify.com/s/files/1/0737/0519/3759/files/image_20.png?v=1721822270"></div>
                      <div class="lma_shop_pay"><a href="#">Check your purchasing power</a></div>
                    {% endcomment %}
                    {% comment %} Shop pay split payment terms {% endcomment %}
                    {%- if request_quote == false -%}
                      {% comment %}<div class="shop-pay-terms small">{{ form | payment_terms }}</div>{% endcomment %}
                    {% endif %}
                    {% if request_quote %}
                      <div class="request_quote_message h4 text-center">We Build Gyms You Love to Work Out In</div>
                    {% endif %}

                    {% assign is_sold_out = false %}
                    {%- if is_current_variant_available and product.tags contains '_preorder' -%}
                    {%- elsif current_variant.inventory_policy == 'continue' and specialOffer == true -%}
                    {%- elsif current_variant.inventory_policy == 'continue' and specialOffer == false -%}
                    {%- elsif is_current_variant_available -%}
                    {%- else -%}
                      {% assign is_sold_out = true %}
                    {%- endif -%}
                    <div id="interact-observer">
                    <div class="product__submit__buttons {% if request_quote or is_sold_out %}remove_bg_color {% endif %} {% if is_sold_out %} lma-is-sold-out {% endif %}">
                      {%- if request_quote == false -%}
                        <!-- Hide the quantity button if the item is sold out -->

                        {% if is_sold_out %}
                          <div class="lma-sold-out-section">
                            <span class="h4" style="font-weight: bold"> Out of Stock </span>
                            {% render 'lma-product-price' %}
                          </div>

                        {% else %}
                          {%- if quantity_position_bottom and show_quantity -%}
                            <div
                              class="selector-wrapper selector-wrapper--qty"
                              {% if animations_enabled %}
                                data-aos="fade-up"
                                data-aos-anchor="{{ animation_anchor }}"
                                data-aos-delay="{{ animation_delay }}"
                                {%- assign animation_delay = animation_delay | plus: 100 -%}
                              {% endif %}
                            >
                              {{ quantity_selector }} 
                            </div>
                          {% else %}
                            <div class="product_price_section">
                              <span class="single_product_second_price">Price</span>
                              <div class="product__price lma_single_product" data-price-wrapper>
                                {%- unless product == blank -%}
                                  <span
                                    data-product-price
                                    class="product__price--regular{% if current_variant.compare_at_price > current_variant.price %} product__price--sale{% endif %}"
                                  >
                                    {%- liquid
                                      if current_variant.price == 0
                                        echo 'products.product.free' | t
                                      elsif currency_code_enable
                                        echo current_variant.price | money_with_currency
                                      else
                                        echo current_variant.price | money
                                      endif
                                    -%}
                                  </span>
                                {%- else -%}
                                  <span id="ProductPrice">
                                    {%- liquid
                                      if currency_code_enable
                                        echo 1999 | money_with_currency
                                      else
                                        echo 1999 | money
                                      endif
                                    -%}
                                  </span>
                                {%- endunless -%}

                                {%- if has_units -%}
                                  {%- assign current_variant_unit_price = current_variant.unit_price -%}
                                  {%- capture show_units -%}
                                  {%- unless current_variant_unit_price -%}style="display: none;"{%- endunless -%}
                                {%- endcapture -%}

                                  {%- capture unit_price_separator -%}
                                  <span aria-hidden="true">/</span><span class="visually-hidden">{{ 'general.accessibility.unit_price_separator' | t }}&nbsp;</span>
                                {%- endcapture -%}

                                  {%- capture unit_price_base_unit -%}
                                  <span>
                                    {%- if current_variant.unit_price_measurement -%}
                                      {% if current_variant.unit_price_measurement.reference_value != 1 %}
                                        {{ current_variant.unit_price_measurement.reference_value }}
                                      {% endif %}
                                      {{ current_variant.unit_price_measurement.reference_unit }}
                                    {%- endif -%}
                                  </span>
                                {%- endcapture -%}
                                {%- endif -%}
                              </div>
                            </div>
                          {%- endif -%}
                        {%- endif -%}
                      {% endif %}

                      <div
                        class="product__submit__item {% if request_quote %}full_width_button{% endif %}"
                        {% if animations_enabled %}
                          data-aos="fade-up"
                          data-aos-anchor="{{ animation_anchor }}"
                          data-aos-delay="{{ animation_delay }}"
                          {%- assign animation_delay = animation_delay | plus: 150 -%}
                        {% endif %}
                      >
                        {% if request_quote and is_sold_out %}
                          <button
                            type="submit"
                            name="add"
                            id="AddToCart--{{ unique }}"
                            class="btn btn--submit product__submit__add"
                            data-add-to-cart
                            data-focus-element
                            {% if show_newsletter %}
                              data-notification-popup="{%- render 'notification-form', product_title: product.title, product_subtitle: current_variant.title, product_id: current_variant.id -%}"
                            {% endif %}
                          >
                            <span data-add-to-cart-text>
                              {{ sold_out_text }}
                            </span>
                          </button>

                        {% elsif request_quote %}
                          <a
                            href="/pages/contact"
                            class="btn btn--submit product__submit__add"
                          >
                            {{ 'products.product.request_quote' | t }}
                          </a>
                        {% else %}
                          <button
                            type="submit"
                            name="add"
                            id="AddToCart--{{ unique }}"
                            class="btn btn--submit product__submit__add"
                            data-add-to-cart
                            data-focus-element
                            {% if show_newsletter %}
                              data-notification-popup="{%- render 'notification-form', product_title: product.title, product_subtitle: current_variant.title, product_id: current_variant.id -%}"
                            {% endif %}
                          >
                            {%- if product.tags contains 'Request Quote' -%}
                              {{ 'products.product.request_quote' | t }}
                            {%- else -%}
                              
                              <span>
                                {%- if is_current_variant_available and product.tags contains '_preorder' -%}
                                  {{ 'products.product.preorder' | t }} 
                                {% elsif is_current_variant_available and specialOffer == true %}
                                  {{ 'products.product.add_to_cart' | t }}
                                {%- elsif is_current_variant_available -%}
                                  {{ 'products.product.add_to_cart' | t }}
                                {%- elsif current_variant.inventory_policy == 'continue' and specialOffer == true -%}
                                  {{ 'products.product.special_offer' | t }} 
                                {%- elsif current_variant.inventory_policy == 'continue' and specialOffer == false -%}
                                  {{ 'products.product.preorder' | t }} 

                                {%- else -%}
                                  {{ sold_out_text }} 
                                {%- endif -%}
                              </span>
                            {%- endif -%}

                            <div class="loader loader--line"><div class="loader-indeterminate"></div></div>
                          </button>
                        {% endif %}
                      </div>
                    </div>
                    </div>
                   

                    <!-- Item is in stock -->
                    {% if current_variant.available and current_variant.inventory_quantity > 0 %}
                      {% if shipping_message != blank %}
                        <div class="lma_estimated_delivery_date">
                          {% if delivery_image %}
                            <img src="{{ delivery_image | img_url }}" height="{{ delivery_image.height }}" width="{{ delivery_image.width }}">
                          {% endif %}
                          {{ shipping_message }}
                          <input
                      type="hidden"
                      name="properties[Delivery Note]"
                      value="{{- shipping_message |  strip_html }}"
                    >
                        </div>
                      {% endif %}
                    
                    <!-- Item is out of stock but still selling -->
                    {% elsif current_variant.inventory_policy == 'continue' %}
                      {% if availability_message != blank %}
                        <div class="lma_estimated_delivery_date">
                          {% if delivery_image and shipping_message != blank %}
                            <img src="{{ delivery_image | img_url }}" height="{{ delivery_image.height }}" width="{{ delivery_image.width }}">
                          {% endif %}
                          {{ availability_message }}
                          <input
                      type="hidden"
                      name="properties[Availability Note]"
                      value="{{- availability_message |  strip_html }}"
                    >
                        </div>
                      {% endif %}
                    {% endif %}

                    <div data-cart-errors-container class="product__form__errors"></div>
                  </div>
                {%- endform -%}
              </div>
            {%- else -%}
              <div
                class="product__block product__form__wrapper{{ hide_labels_class }}"
                data-form-wrapper
                {{ block_style }}
                {{ block.shopify_attributes }}
              >
                {%- liquid
                  assign enable_color_swatches = settings.enable_color_swatches_product
                  assign variants_style = settings.variants_style
                  assign show_quantity = false
                  if product.metafields.custom.quantity.value == true
                    assign show_quantity = true
                  endif
                  assign show_payment_button = false
                  if block.settings.show_payment_button and settings.enable_accept_terms == false
                    assign show_payment_button = true
                  endif
                  assign quantity_position_bottom = true

                  assign enable_variant_boxes = false
                  if variants_style == 'boxes' or variants_style == 'auto'
                    assign enable_variant_boxes = true
                  endif

                  capture selector_wrapper_class
                    echo 'selector-wrapper'
                    if enable_variant_boxes
                      echo ' selector-wrapper--boxes'
                    endif

                    if enable_color_swatches
                      echo ' selector-wrapper--swatches'
                    endif
                  endcapture
                -%}

                {%- capture quantity_selector -%}
<div class="select__fieldset">
<span class="select__label" id="{{ section.id }}-select-quantity-label">{{ 'products.product.quantity' | t }}</span>

<div class="select-popout select-popout--small" data-popout data-popout-prevent="true">
  <button type="button" class="select-popout__toggle{% if variants_style == 'boxes' %} select-popout__toggle--qty{% endif %}" aria-expanded="false" aria-controls="{{ section.id }}-select-quantity" aria-labelledby="{{ section.id }}-select-quantity-label" data-popout-toggle data-popout-quantity>
    <span class="select-popout__value" data-popout-text data-quantity-select>1</span>
    {%- render 'icon-select' -%}
  </button>

  <div id="{{ section.id }}-select-quantity" class="select-popout__list" data-popout-list>
    <ul class="select-popout__list__scroll">
      {%- for idx in (1..10) -%}
        <li class="select-popout__item {% if forloop.index == 1 %}select-popout__item--current{% endif %}">
          <a class="select-popout__option" href="#" {% if forloop.index == 1 %}aria-current="true"{% endif %} data-value="{{ forloop.index }}" data-popout-option>
            <span>{{ forloop.index }} {% if forloop.last %}+{% endif %}</span>
          </a>
        </li>
      {%- endfor -%}
    </ul>
  </div>

  <div class="quantity-selector" data-quantity-holder>
    <label for="product-quantity-buttons-{{ section.id }}" class="label-hidden">{{ 'products.product.quantity' | t }}</label>

    <button type="button" class="quantity__btn quantity__btn--decrease" data-quantity-minus data-quantity-button tabindex="0" title="{{ 'general.accessibility.decrease' | t }} - {{ product.title | strip_html -}}">
      <span class="visually-hidden">{{ 'general.accessibility.decrease' | t }}</span>
      {%- render 'icon-toggle-minus' -%}
    </button>

    <input id="product-quantity-buttons-{{ section.id }}" data-popout-input type="number" class="quantity__selector quantity__input" value="1" min="1" aria-label="quantity" autocomplete="off" name="quantity" data-quantity-field title="{{- 'products.product.quantity' | t }} - {{ product.title | strip_html -}}" pattern="[0-9]*" />

    <button type="button" class="quantity__btn quantity__btn--increase" data-quantity-plus data-quantity-button tabindex="0" title="{{- 'general.accessibility.increase' | t }} - {{ product.title | strip_html -}}">
      <span class="visually-hidden">{{ 'general.accessibility.increase' | t }}</span>
      {%- render 'icon-toggle-plus' -%}
    </button>
  </div>
</div>
</div>
{%- endcapture -%}

                <div class="product__form product__form--onboarding">
                  <div class="product__selectors">
                    <div
                      class="{{ selector_wrapper_class }}"
                      data-option-position="1"
                      {% if animations_enabled %}
                        data-aos="fade-up"
                        data-aos-anchor="{{ animation_anchor }}"
                        data-aos-delay="{{ animation_delay }}"
                        {%- assign animation_delay = animation_delay | plus: 150 -%}
                      {% endif %}
                    >
                      {%- if enable_variant_boxes or enable_color_swatches -%}
                        <fieldset class="radio__fieldset">
                          <legend class="radio__legend">
                            <span class="radio__legend__label">{{- 'homepage.onboarding.color' | t -}}</span>
                          </legend>

                          {%- if enable_color_swatches -%}
                            {%- render 'product-swatch--onboarding' -%}

                            {%- unless enable_variant_boxes -%}
                              {%- assign quantity_position_bottom = false -%}
                            {%- endunless -%}
                          {%- else -%}
                            {%- for i in (1..3) -%}
                              {%- capture value -%}{%- cycle 'White', 'Grey', 'Black' -%}{%- endcapture -%}
                              <span class="radio__button">
                                <input
                                  type="radio"
                                  class="radio__input"
                                  data-single-option-selector
                                  data-index="option1"
                                  name="color--{{ section.id }}"
                                  value="{{ value | escape_once }}"
                                  id="option-{{ value }}-0-{{ section.id }}"
                                  {% if forloop.index == 1 %}
                                    checked
                                  {% endif %}
                                >
                                <label for="option-{{ value }}-0-{{ section.id }}" class="radio__label">
                                  <span>{{ value | escape_once }}</span>
                                </label>
                              </span>
                            {%- endfor -%}
                          {%- endif -%}
                        </fieldset>
                      {%- else -%}
                        <div class="select__fieldset">
                          <span class="radio__legend">
                            <span class="radio__legend__label" id="onboarding-{{ section.id }}-option-0-label">
                              {{- 'homepage.onboarding.color' | t -}}
                            </span>
                          </span>

                          <div class="select-popout" data-popout data-popout-prevent="true">
                            <button
                              type="button"
                              class="select-popout__toggle"
                              aria-expanded="false"
                              aria-controls="onboarding-{{ section.id }}-option-0-list"
                              aria-labelledby="onboarding-{{ section.id }}-option-0-label"
                              data-popout-toggle
                            >
                              <span class="select-popout__value" data-popout-text>White</span>
                              {%- render 'icon-select' -%}
                            </button>

                            <div
                              id="onboarding-{{ section.id }}-option-0-list"
                              class="select-popout__list"
                              data-popout-list
                            >
                              <ul class="select-popout__list__scroll">
                                {%- for i in (1..3) -%}
                                  {%- capture value -%}{%- cycle 'White', 'Grey', 'Black' -%}{%- endcapture -%}
                                  <li class="select-popout__item{% if forloop.index == 1 %} select-popout__item--current{% endif %}">
                                    <a
                                      class="select-popout__option"
                                      href="#"
                                      {% if forloop.index == 1 %}
                                        aria-current="true"
                                      {% endif %}
                                      data-value="{{ value | escape_once }}"
                                      data-popout-option
                                    >
                                      <span>
                                        {{ value | escape_once }}
                                      </span>
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                            <input
                              type="hidden"
                              name="options[Color]"
                              id="onboarding-{{ section.id }}-option-0"
                              value="White"
                              data-popout-input
                              data-single-option-selector
                              data-index="option1"
                            >
                          </div>
                        </div>
                      {%- endif -%}
                    </div>

                    <div
                      class="selector-wrapper{% if enable_variant_boxes %} selector-wrapper--boxes{% endif %}"
                      data-option-position="2"
                      {% if animations_enabled %}
                        data-aos="fade-up"
                        data-aos-anchor="{{ animation_anchor }}"
                        data-aos-delay="{{ animation_delay }}"
                        {%- assign animation_delay = animation_delay | plus: 150 -%}
                      {% endif %}
                    >
                      {%- if enable_variant_boxes -%}
                        <fieldset class="radio__fieldset">
                          <legend class="radio__legend">
                            <span class="radio__legend__label">{{- 'homepage.onboarding.size' | t -}}</span>
                          </legend>

                          {%- for i in (1..3) -%}
                            {%- capture value -%}{%- cycle 'Small', 'Medium', 'Large' -%}{%- endcapture -%}
                            <span class="radio__button">
                              <input
                                type="radio"
                                class="radio__input"
                                data-single-option-selector
                                data-index="option2"
                                name="size--{{ section.id }}"
                                value="{{ value | escape_once }}"
                                id="option-{{ value }}-1-{{ section.id }}"
                                {% if forloop.index == 1 %}
                                  checked
                                {% endif %}
                              >
                              <label for="option-{{ value }}-1-{{ section.id }}" class="radio__label">
                                <span>{{ value | escape_once }}</span>
                              </label>
                            </span>
                          {%- endfor -%}
                        </fieldset>
                      {%- else -%}
                        <div class="select__fieldset">
                          <span class="radio__legend">
                            <span class="radio__legend__label" id="onboarding-{{ section.id }}-option-1-label">
                              {{- 'homepage.onboarding.size' | t -}}
                            </span>
                          </span>

                          <div class="select-popout" data-popout data-popout-prevent="true">
                            <button
                              type="button"
                              class="select-popout__toggle"
                              aria-expanded="false"
                              aria-controls="onboarding-{{ section.id }}-option-1-list"
                              aria-labelledby="onboarding-{{ section.id }}-option-1-label"
                              data-popout-toggle
                            >
                              <span class="select-popout__value" data-popout-text>Small</span>
                              {%- render 'icon-select' -%}
                            </button>

                            <div
                              id="onboarding-{{ section.id }}-option-1-list"
                              class="select-popout__list"
                              data-popout-list
                            >
                              <ul class="select-popout__list__scroll">
                                {%- for i in (1..3) -%}
                                  {%- capture value -%}{%- cycle 'Small', 'Medium', 'Large' -%}{%- endcapture -%}
                                  <li class="select-popout__item{% if forloop.index == 1 %} select-popout__item--current{% endif %}">
                                    <a
                                      class="select-popout__option"
                                      href="#"
                                      {% if forloop.index == 1 %}
                                        aria-current="true"
                                      {% endif %}
                                      data-value="{{ value | escape_once }}"
                                      data-popout-option
                                    >
                                      <span>
                                        {{ value | escape_once }}
                                      </span>
                                    </a>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                            <input
                              type="hidden"
                              name="options[Size]"
                              id="onboarding-{{ section.id }}-option-1"
                              value="White"
                              data-popout-input
                              data-single-option-selector
                              data-index="option2"
                            >
                          </div>
                        </div>
                      {%- endif -%}
                    </div>

                    {%- if show_quantity -%}
                      {%- unless quantity_position_bottom -%}
                        <div
                          class="selector-wrapper"
                          {% if animations_enabled %}
                            data-aos="fade-up"
                            data-aos-anchor="{{ animation_anchor }}"
                            data-aos-delay="{{ animation_delay }}"
                            {%- assign animation_delay = animation_delay | plus: 150 -%}
                          {% endif %}
                        >
                          {{ quantity_selector }}
                        </div>
                      {%- endunless -%}
                    {%- endif -%}
                  </div>

                  {%- if show_quantity and quantity_position_bottom -%}
                    <div
                      class="selector-wrapper{% if variants_style == 'boxes' %} selector-wrapper--qty{% endif %}"
                      {% if animations_enabled %}
                        data-aos="fade-up"
                        data-aos-anchor="{{ animation_anchor }}"
                        data-aos-delay="{{ animation_delay }}"
                        {%- assign animation_delay = animation_delay | plus: 150 -%}
                      {% endif %}
                    >
                      {{ quantity_selector }}
                    </div>
                  {%- endif -%}

                  <div
                    class="product__submit__holder{% if show_payment_button %} product__submit__holder--spb{% endif %}"
                    data-product-id="onboarding-product-{{ section.id }}"
                  >
                    <div id="interact-observer">
                    <div class="product__submit__buttons">
                      <div
                        class="product__submit__item"
                        {% if animations_enabled %}
                          data-aos="fade-up"
                          data-aos-anchor="{{ animation_anchor }}"
                          data-aos-delay="{{ animation_delay }}"
                          {%- assign animation_delay = animation_delay | plus: 150 -%}
                        {% endif %}
                      >
                        <button
                          type="submit"
                          name="add"
                          id="AddToCart--{{ unique }}"
                          class="btn btn--submit product__submit__add"
                          data-add-to-cart
                          data-focus-element
                        >
                          <span data-add-to-cart-text>{{ 'products.product.add_to_cart' | t }}</span>
                        </button>
                      </div>
                      {% if show_payment_button %}
                        <div
                          class="product__submit__item"
                          data-buy-it-now
                          {% if animations_enabled %}
                            data-aos="fade-up"
                            data-aos-anchor="{{ animation_anchor }}"
                            data-aos-delay="{{ animation_delay }}"
                            {%- assign animation_delay = animation_delay | plus: 150 -%}
                          {% endif %}
                        >
                          <div class="shopify-payment-button">
                            <button class="shopify-payment-button__button shopify-payment-button__button--unbranded">
                              Buy it now
                            </button>
                          </div>
                        </div>
                      {% endif %}
                    </div>
                  </div></div>
                </div>
              </div>
            {%- endunless -%}

          {%- when 'pickup' -%}
            {%- comment -%} Surface pickup availability {%- endcomment -%}
            <div
              class="product__block product-single__store-availability-container"
              data-store-availability-container
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            ></div>

          {%- when 'description' -%}
            <div
              class="product__block product__description rte"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {%- unless product == blank -%}
                {{- product.description -}}
              {%- else -%}
                <p>{{ 'homepage.onboarding.single_product_description' | t }}</p>
              {%- endunless -%}
            </div>

          {%- when 'cutline' -%}
            {%- assign cutline_color = block.settings.cutline_color -%}

            <div
              class="product__block product__cutline"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {%- if product.metafields.theme.cutline != blank
                and product.metafields.theme.cutline.type == 'single_line_text_field'
              -%}
                {%- liquid
                  capture style
                    case cutline_color
                      when 'body'
                        echo 'color: var(--text);'
                      when 'accent'
                        echo 'color: var(--accent);'
                    endcase
                  endcapture
                -%}

                <p class="product-cutline" style="{{ style }}">{{ product.metafields.theme.cutline.value }}</p>
              {%- endif -%}
            </div>

          {%- when 'product_accordions' -%}
            {%- comment -%} Accordions {%- endcomment -%}
            <div
              class="product__block product__accordions"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {%- render 'product-accordions', block_settings: block.settings -%}
            </div>

          {%- when 'upsell' -%}
            {%- liquid
              assign upsell_unique = unique | append: block.id
              assign upsell_products = block.settings.product_list
              assign upsell_product_list_count = upsell_products.count
              assign legacy_upsell_product = product.metafields.theme.upsell.value | default: false
              assign index = upsell_product_list_count

              capture upsell_items
                for upsell_product in upsell_products
                  render 'upsell-product', upsell_product: upsell_product, index: forloop.index, unique: upsell_unique
                endfor

                if legacy_upsell_product
                  assign index = upsell_product_list_count | plus: 1
                  render 'upsell-product', upsell_product: legacy_upsell_product, index: index, unique: upsell_unique
                endif
              endcapture

              assign upsell_slider = false
              if index > 1
                assign upsell_slider = true
              endif
            -%}

            <div
              id="Block--{{ block.id }}"
              class="product__block upsell__products{% if upsell_slider %} upsell__products--slider{% endif %}"
              {% if animations_enabled and upsell_items != blank %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {%- if upsell_slider -%}
                <div class="upsell__products__slider" data-upsell-slider>
                  {{- upsell_items -}}
                </div>
              {%- else -%}
                {{- upsell_items -}}
              {%- endif -%}
            </div>

          {%- when 'complementary-products' -%}
            <div
              class="product__block product__complementary"
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              <complementary-products
                class="complementary-products"
                data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit=10&intent=complementary"
                data-complementary-products
              >
                {%- if recommendations.performed and recommendations.products_count > 0 -%}
                  {%- assign complementary_products_title = 'general.complementary.products_title' | t -%}

                  {%- if complementary_products_title != blank -%}
                    <p
                      class="complementary-products__title"
                      {% if animations_enabled %}
                        data-aos="fade-up"
                        data-aos-anchor="{{ animation_anchor }}"
                        data-aos-delay="{{ animation_delay }}"
                        {%- assign animation_delay = animation_delay | plus: 150 -%}
                      {% endif %}
                    >
                      {{- complementary_products_title -}}
                    </p>
                  {%- endif -%}

                  {%- for product in recommendations.products -%}
                    <div
                      class="complementary-products__item"
                      {% if animations_enabled %}
                        data-aos="fade-up"
                        data-aos-anchor="{{ animation_anchor }}"
                        data-aos-delay="{{ animation_delay }}"
                        {%- assign animation_delay = animation_delay | plus: 150 -%}
                      {% endif %}
                    >
                      {%- render 'upsell-product', upsell_product: product, is_complementary: true -%}
                    </div>
                  {%- endfor -%}
                {%- endif -%}
              </complementary-products>
            </div>

          {%- when 'share-button' -%}
            {%- comment -%} Social Icons {%- endcomment -%}
            <div class="product__block" {{ block_style }} {{ block.shopify_attributes }}>
              {%- liquid
                assign text = block.settings.text

                if product.url != blank
                  assign link = shop.url | append: product.url
                else
                  assign link = ''
                endif

                render 'share-button', text: text, link: link, animation_anchor: animation_anchor, animation_delay: animation_delay
                assign animation_delay = animation_delay | plus: 150
              -%}
            </div>

          {%- when 'custom_code' -%}
            <div
              class="product__block"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              <div class="lma_cutom_code">
                {{ block.settings.custom_code }}
              </div>
            </div>

          {%- when 'text' -%}
            {%- assign text_alignment = block.settings.text_alignment -%}
            <div
              class="product__block"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {% if block.settings.heading_title != blank %}
                <h4 class="main-heading-title h5 strong">{{ block.settings.heading_title }}</h4>
              {% endif %}
              {%- if block.settings.title != blank -%}
                <div
                  class="product__subheading{% if text_alignment == 'center' %} text-center{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {{ block.settings.title }}
                </div>
              {%- endif -%}
            </div>

          {%- when 'icon' -%}
            {%- liquid
              assign icon_width = block.settings.icon_width
              assign icon_image = block.settings.icon_image
              assign icon_name = block.settings.icon_name
              assign icon_color = block.settings.icon_color
              assign width = block.settings.width
              assign text_size = block.settings.text_size | times: 0.01
              assign text_alignment = block.settings.text_alignment
              assign bg_color = block.settings.bg_color

              if icon_image != blank
                assign retina_size = icon_width | times: 2
                assign image_widths = '50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150'
              endif
            -%}

            {%- capture background_style -%}
              --bg: {{ bg_color }};

              {%- if bg_color != 'rgba(0,0,0,0)' and bg_color != '' and bg_color != section.settings.bg_color -%}
                padding: 5px 10px;
              {%- endif -%}
            {%- endcapture -%}

            {%- capture icon_style -%}
              --icon-size: {{ icon_width }}px;

              {%- if icon_image -%}
                --aspect-ratio: {{ 1 | divided_by: icon_image.aspect_ratio | times: 100 | round: 1 }}%;
              {%- endif -%}

              {%- if icon_color != '' and icon_color != 'rgba(0,0,0,0)' and icon_image == blank -%}
                color: {{ icon_color }};
              {%- endif -%}
            {%- endcapture -%}

            {%- capture text_style -%}
              --adjust-body: calc(var(--FONT-ADJUST-BODY) * {{ text_size }});
            {%- endcapture -%}

            <div
              class="product__block{% if width == 'half' %} product__block--half{% endif %}"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              <div
                class="product__icon__row{% if text_alignment == 'center' %} product__icon__row--center{% endif %}"
                style="{{ text_style }} {{ background_style }}"
              >
                {%- unless icon_image == blank and icon_name == 'none' -%}
                  <div class="product__icon icon-stroke" style="{{ icon_style }}">
                    {%- if icon_image != blank -%}
                      <div class="product__icon__holder">
                        {%- render 'image',
                          image: icon_image,
                          width: retina_size,
                          widths: image_widths,
                          sizes: 'auto',
                          classes: 'product__icon__img'
                        -%}
                      </div>
                    {%- else -%}
                      {%- render 'icons', icon: icon_name -%}
                    {%- endif -%}
                  </div>
                {%- endunless -%}

                {%- if block.settings.icon_text != blank -%}
                  <div class="product__icon__text">{{ block.settings.icon_text }}</div>
                {%- endif -%}
              </div>
            </div>

          {%- when 'icon_row' -%}
            {%- assign bg_color = block.settings.bg_color -%}
            {%- assign alignment = block.settings.alignment -%}

            {%- capture background_style -%}
              --bg: {{ bg_color }};

              {%- if bg_color != 'rgba(0,0,0,0)' and bg_color != '' and bg_color != section.settings.bg_color  -%}
                padding: var(--grid-gutter);
              {%- endif -%}
            {%- endcapture -%}

            <div
              class="product__block text-{{ alignment }}"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              <div class="product__icon__row product__icon__row--multiple" style="{{ background_style }}">
                {%- render 'icon-row', block_settings: block.settings -%}
              </div>
            </div>

          {%- when 'inventory_countdown' -%}
            <div
              class="product__block"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {%- render 'inventory-countdown',
                current_variant: current_variant,
                product_variants: product.variants,
                max_inventory: block.settings.max_inventory,
                hide_inventory_count: block.settings.hide_inventory_count
              -%}
            </div>

          {%- when 'popup_text' -%}
            {%- liquid
              assign text = block.settings.text
              assign popup_page = pages[block.settings.popup_page]
            -%}

            <div
              class="product__block product__popup__wrapper"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
              {{ block.shopify_attributes }}
            >
              {%- unless text == blank -%}
                <button
                  type="button"
                  class="product__popup__link"
                  href="{{ popup_page.url }}"
                  aria-controls="popup-text--{{ block.id }}"
                  data-drawer-toggle
                >
                  {{ text }}
                </button>

                {%- capture popup_text -%}
                  <div class="product__popup drawer drawer--left" id="popup-text--{{ block.id }}" aria-hidden="true" role="dialog" data-drawer>
                    <button type="button" class="drawer__close-button" aria-controls="popup-text--{{ block.id }}" data-drawer-toggle>
                      <span class="visually-hidden">{{ 'general.accessibility.close_drawer' | t }}</span>
                      {%- render 'icon-close' -%}
                    </button>

                    <div class="product__popup__inner" data-scroll>
                      <div class="product__popup__content rte">
                        {%- unless popup_page.content == blank -%}
                          {{ popup_page.content }}
                        {%- else -%}
                          {{ 'products.product.popup_missing' | t }}
                        {%- endunless -%}
                      </div>
                    </div>
                  </div>
                {%- endcapture -%}
              {%- endunless -%}
            </div>

          {%- when 'divider' -%}
            <div class="product__block" {{ block_style }} {{ block.shopify_attributes }}>
              {%- if block.settings.show_line -%}
                <hr
                  class="hr--full"
                  {% if animations_enabled %}
                    data-aos="fade-up"
                    data-aos-anchor="{{ animation_anchor }}"
                    data-aos-delay="{{ animation_delay }}"
                    {%- assign animation_delay = animation_delay | plus: 150 -%}
                  {% endif %}
                >
              {%- endif -%}
            </div>

          {%- when 'sku_purchase' -%}
            <div class="product__block" {{ block_style }} {{ block.shopify_attributes }}>
              <div class="lma-custom-sku-questions">
                {%- if current_variant.sku != blank and block.settings.enable_sku == true -%}
                  <div class="lma-sku">SKU : {{ current_variant.sku }}</div>
                {%- endif -%}
                {% comment %}{%- if block.settings.min_purchase != 0 -%}
                  <div class="lma-min-purchase">Minimum Purchase: {{ block.settings.min_purchase }} unit</div>
                {%- endif -%}{% endcomment %}
              </div>
            </div>

          {% when 'lma_video_link' %}
            {%- assign video_link = block.settings.video_link -%}
            {%- if video_link contains 'watch?v=' -%}
              {%- assign video_link = video_link | replace: 'watch?v=', 'embed/' -%}
            {%- endif -%}
            {% if video_link != blank %}
              <div class="product__block" {{ block_style }} {{ block.shopify_attributes }}>
                <div class="lma-video">
                  <iframe
                    src="{{ video_link }}"
                    title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin"
                    allowfullscreen
                  ></iframe>
                </div>
              </div>
            {% endif %}
          {% when 'includes' %}
            {% if block.settings.includes_text != blank and block.settings.includes_desc != blank %}
              <div class="product__block" {{ block_style }} {{ block.shopify_attributes }}>
                <div class="lma_includes_title h6 strong">{{ block.settings.includes_text }}</div>
                <div class="lma_includes_description">{{ block.settings.includes_desc }}</div>
              </div>
            {% endif %}
        {%- endcase -%}
      {%- endfor -%}
    </div>
  </div>

  {%- comment -%}Popup text & size chart drawers, leave outsude .form__wrapper otherwise it will break when sticky form is enabled{%- endcomment -%}
  {{- popup_text -}}
  {{- size_chart_modal -}}

  <script type="application/json" id="ProductJson-{{ unique }}" data-product-json>
    {{ product | json }}
  </script>
  <script type="application/json" id="ModelJson-{{ unique }}">
    {{ product.media | where: 'media_type', 'model' | json }}
  </script>
</div>
{%- else -%}
{%- unless multiple_quick_view_items -%}
  <div class="popup-quick-view__inner" data-section-id="{{ unique }}" data-quick-view-inner>
    <div
      class="popup-quick-view__item"
      data-product
      {% if product == blank %}
        data-quick-view-onboarding
      {% endif %}
      data-quick-view-item
    >
{%- endunless -%}

{%- comment -%} Code to be shown on QuickView {%- endcomment -%}
{%- assign unique = unique | default: '' -%}
{%- assign product_form_id = 'AddToCartForm--' | append: unique -%}

{%- assign quickview_form_classes = 'product__form popup-quick-view__form'
  | append: ' popup-quick-view__form--'
  | append: settings.quick_buy_image_layout
-%}

{%- if product != blank -%}
  {%- form 'product', product, class: quickview_form_classes, data-product-form: '', id: product_form_id -%}
    <div
      class="popup-quick-view__wrapper product__form__wrapper{{ hide_labels_class }}{% if sold_out %} variant--soldout{% endif %}"
      data-form-wrapper
      data-scroll-lock-scrollable
    >
      <div class="popup-quick-view__body" data-scroll-lock-scrollable>
        {%- if quick_view_nav != '' -%}
          {{- quick_view_nav -}}
        {%- endif -%}

        <div class="popup-quick-view__body__inner">
          <div class="popup-quick-view__content">
            <a
              href="#"
              title="{{ 'general.accessibility.close' | t }} (Esc)"
              class="popup-quick-view__close"
              data-popup-close
            >
              {%- render 'icon-close' -%}
            </a>

            <h1 class="popup-quick-view__title">
              <a href="{{ product_url }}" title="{{ product_title }}">{{ product_title }}</a>
            </h1>

            {%- assign currency_code_enable = settings.currency_code_enable -%}

            <div
              class="product__block product__price-and-badge"
              {% if animations_enabled %}
                data-aos="fade-up"
                data-aos-anchor="{{ animation_anchor }}"
                data-aos-delay="{{ animation_delay }}"
                {%- assign animation_delay = animation_delay | plus: 150 -%}
              {% endif %}
              {{ block_style }}
            >
              <div class="product__price" data-price-wrapper>
                {%- unless product == blank -%}
                  <span
                    data-product-price
                    class="product__price--regular{% if current_variant.compare_at_price > current_variant.price %} product__price--sale{% endif %}"
                  >
                    {%- liquid
                      if current_variant.price == 0
                        echo 'products.product.free' | t
                      elsif currency_code_enable
                        echo current_variant.price | money_with_currency
                      else
                        echo current_variant.price | money
                      endif
                    -%}
                  </span>
                {%- else -%}
                  <span id="ProductPrice">
                    {%- liquid
                      if currency_code_enable
                        echo 1999 | money_with_currency
                      else
                        echo 1999 | money
                      endif
                    -%}
                  </span>
                {%- endunless -%}

                <s data-compare-price class="product__price--compare">
                  {%- liquid
                    if current_variant.compare_at_price
                      if currency_code_enable
                        echo current_variant.compare_at_price | money_with_currency
                      else
                        echo current_variant.compare_at_price | money
                      endif
                    endif
                  -%}
                </s>

                {%- liquid
                  assign units = product.variants | map: 'unit_price' | compact
                  if units[0]
                    assign has_units = true
                  else
                    assign has_units = false
                  endif
                -%}

                {%- if has_units -%}
                  {%- assign current_variant_unit_price = current_variant.unit_price -%}
                  {%- capture show_units -%}
      {%- unless current_variant_unit_price -%}style="display: none;"{%- endunless -%}
    {%- endcapture -%}

                  {%- capture unit_price_separator -%}
      <span aria-hidden="true">/</span><span class="visually-hidden">{{ 'general.accessibility.unit_price_separator' | t }}&nbsp;</span>
    {%- endcapture -%}

                  {%- capture unit_price_base_unit -%}
      <span>
        {%- if current_variant.unit_price_measurement -%}
          {% if current_variant.unit_price_measurement.reference_value != 1 %}
            {{ current_variant.unit_price_measurement.reference_value }}
          {% endif %}
          {{ current_variant.unit_price_measurement.reference_unit }}
        {%- endif -%}
      </span>
    {%- endcapture -%}

                  <span class="product__unit-price">
                    <span
                      data-product-unit
                      class="product__price--unit{% unless current_variant_unit_price %} hidden{% endunless %}"
                    >
                      <span class="visually-hidden">{{ 'products.product.unit_price_label' | t }}</span>
                      <span data-product-unit-price id="unit-price-{{ section.id }}">
                        {{- current_variant_unit_price | money -}}
                      </span>
                      {{ unit_price_separator }}
                      <span data-product-base id="unit-price-base-{{ section.id }}">{{ unit_price_base_unit }}</span>
                    </span>
                  </span>
                {%- endif -%}

                <span data-price-off class="product__price--off hidden">
                  <span data-price-off-type>{{ 'products.product.sale' | t }}</span>
                  <em>â€¢</em>
                  {{ 'products.product.save' | t }}
                  <span data-price-off-amount></span>
                </span>
              </div>

              {%- if block.settings.show_rating or settings.show_rating and section_type == 'quickview' -%}
                {%- unless product == blank -%}
                  {%- render 'rating',
                    show_rating_count: block.settings.show_rating_count,
                    single_star: true,
                    reviews: product.metafields.reviews
                  -%}
                {%- else -%}
                  {%- render 'rating',
                    show_rating_count: block.settings.show_rating_count,
                    single_star: true,
                    onboarding: true
                  -%}
                {%- endunless -%}
              {%- endif -%}
            </div>

            {%- if product.metafields.theme.cutline != blank
              and product.metafields.theme.cutline.type == 'single_line_text_field'
            -%}
              {%- liquid
                capture style
                  case cutline_color
                    when 'body'
                      echo 'color: var(--text);'
                    when 'accent'
                      echo 'color: var(--accent);'
                  endcase
                endcapture
              -%}

              <p class="product-cutline" style="{{ style }}">{{ product.metafields.theme.cutline.value }}</p>
            {%- endif -%}
          </div>

          <div class="popup-quick-view__gallery">
            {{- product_gallery -}}
          </div>
        </div>

        <div data-form-wrapper>
          {%- comment -%} Product Form Variants {%- endcomment -%}
          <!-- /partials/product-form-quickview-body.liquid -->

          {%- liquid
            assign current_variant = product.selected_or_first_available_variant
            assign variants_style = settings.variants_style

            comment
              Override buy button setting if there are selling plan groups and cart terms
            endcomment
            if show_payment_button and product.selling_plan_groups.size < 1 and settings.enable_accept_terms == false
              assign show_payment_button = true
            else
              assign show_payment_button = false
            endif
          -%}

          <div class="product__form">
            {% comment %} The input with name="id" submits to cart {% endcomment %}
            <input type="hidden" name="id" value="{{ current_variant.id }}" data-product-select>

            {%- unless show_quantity -%}
              <input type="hidden" name="quantity" value="1">
            {%- endunless -%}

            {%- if show_remaining -%}
              {%- render 'inventory-countdown',
                current_variant: current_variant,
                product_variants: product.variants
              -%}
            {%- endif -%}

            {% comment %} Shop pay split payment terms {% endcomment %}
            <div class="shop-pay-terms">{{ form | payment_terms }}</div>

            {%- capture quantity_selector -%}
  <div class="select__fieldset">
    <span class="select__label" id="{{ unique }}-select-quantity-label">{{ 'products.product.quantity' | t }}</span>

    <div class="select-popout select-popout--small" data-popout data-popout-prevent="true">
      <button type="button" class="select-popout__toggle{% if variants_style == 'boxes' %} select-popout__toggle--qty{% endif %}" aria-expanded="false" aria-controls="{{ unique }}-select-quantity" aria-labelledby="{{ unique }}-select-quantity-label" data-popout-toggle data-popout-quantity>
        <span class="select-popout__value" data-popout-text data-quantity-select>1</span>
        {%- render 'icon-select' -%}
      </button>

      <div id="{{ unique }}-select-quantity" class="select-popout__list" data-popout-list>
        <ul class="select-popout__list__scroll">
          {%- for idx in (1..10) -%}
            <li class="select-popout__item{% if forloop.index == 1 %} select-popout__item--current{% endif %}">
              <a class="select-popout__option" href="#" {% if forloop.index == 1 %}aria-current="true"{% endif %} data-value="{{ forloop.index }}" data-popout-option>
                <span>{{ forloop.index }} {% if forloop.last %}+{% endif %}</span>
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </div>

      <div class="quantity-selector" data-quantity-holder>
        <label for="product-quantity-buttons-{{ section.id }}" class="label-hidden">{{ 'products.product.quantity' | t }}</label>

        <button type="button" class="quantity__btn quantity__btn--decrease" data-quantity-minus data-quantity-button tabindex="0" title="{{ 'general.accessibility.decrease' | t }} - {{ product.title | strip_html -}}">
          <span class="visually-hidden">{{ 'general.accessibility.decrease' | t }}</span>
          {%- render 'icon-toggle-minus' -%}
        </button>

        <input id="product-quantity-buttons-{{ section.id }}" data-popout-input type="number" class="quantity__selector quantity__input" value="1" min="1" aria-label="quantity" autocomplete="off" name="quantity" data-quantity-field title="{{- 'products.product.quantity' | t }} - {{ product.title | strip_html -}}" pattern="[0-9]*" />

        <button type="button" class="quantity__btn quantity__btn--increase" data-quantity-plus data-quantity-button tabindex="0" title="{{- 'general.accessibility.increase' | t }} - {{ product.title | strip_html -}}">
          <span class="visually-hidden">{{ 'general.accessibility.increase' | t }}</span>
          {%- render 'icon-toggle-plus' -%}
        </button>
      </div>
    </div>
  </div>
{%- endcapture -%}

            {%- capture form_fields -%}
  {%- unless product.has_only_default_variant -%}
    {%- assign selects_counter = 0 -%}
    <div class="product__selectors">
      {%- for option in product.options_with_values -%}
        {%- comment -%} Use select over radio for long inputs and mismatched lengths {%- endcomment -%}

        {%- assign option_name_handle_separator = option.name | handle | prepend: ',' | append: ',' -%}
        {%- assign enable_color_swatches = settings.enable_color_swatches_product -%}

        {%- liquid
if enable_color_swatches
  comment
    Determine if current option matches swatch handle translations
  endcomment
  assign is_swatch_option = false
  assign swatch_translation = 'general.swatches.color' | t
  assign translation_string = swatch_translation | remove: '  ' | replace: ', ', ',' | replace: ' ,', ',' | replace: ',', '____' | handle | replace: '____', ',' | append: ',' | prepend: ','

  if translation_string contains option_name_handle_separator
    assign is_swatch_option = true
  endif
endif
-%}

        {%- liquid
          assign longest_value = 0
          assign shortest_value = 100
          for value in option.values
            if value.size > longest_value
              assign longest_value = value.size
            endif

            if value.size < shortest_value
              assign shortest_value = value.size
            endif
          endfor

          assign flexible = true
          assign chars_diff = longest_value | minus: shortest_value
          if chars_diff < 5 and longest_value < 6
            assign flexible = false
          endif

          assign enable_variant_boxes = false
          if variants_style == 'boxes' or variants_style == 'auto' and longest_value < 16
            assign enable_variant_boxes = true
          endif

          capture selector_wrapper_class
            echo 'selector-wrapper'
            if enable_variant_boxes
              echo ' selector-wrapper--boxes'

              unless flexible or is_swatch_option
                echo ' selector-wrapper--grid'
              endunless
            endif

            if is_swatch_option
              echo ' selector-wrapper--swatches'
            endif
          endcapture
        -%}

        <div class="{{ selector_wrapper_class }}"
          data-option-position="{{ option.position }}"
          {% if animations_enabled %}
            data-aos="fade-up"
            data-aos-anchor="{{ animation_anchor }}"
            data-aos-delay="{{ animation_delay }}"
            {%- assign animation_delay = animation_delay | plus: 100 -%}
          {% endif %}>
          {%- if enable_variant_boxes or is_swatch_option -%}
            {%- assign current_value = current_variant.options[forloop.index0] -%}
            <fieldset class="radio__fieldset radio__fieldset--{{ settings.color_swatches_product_style }}">
              <legend class="radio__legend">
                <span class="radio__legend__label">{{ option.name | escape_once }}</span>
              </legend>
              {%- for value in option.values -%}
                {%- capture input_id -%}{{ product.id }}-{{ option.name | escape_once }}-{{ value | escape_once }}{%- endcapture -%}

                {%- if is_swatch_option -%}
                  <span class="swatch__button swatch__button--{{ settings.color_swatches_product_style }}" data-tooltip="{{ value | escape_once | capitalize }}">
                    <input type="radio"
                      class="swatch__input"
                      data-single-option-selector
                      data-index="option{{ option.position }}"
                      name="options[{{ option.name | escape_once }}]"
                      value="{{ value | escape_once }}"
                      id="{{ input_id }}"
                      {% if value == current_value %}checked{% endif %}>
                    <label for="{{ input_id }}" class="swatch__label" data-swatch="{{ value | escape_once }}" data-tooltip="{{ value | escape_once }}">
                      <span class="visually-hidden">{{ value | escape_once }}</span>
                      {%- if settings.color_swatches_product_style == 'circle' -%}
                        <span class="icon icon-check"></span>
                      {%- endif -%}
                    </label>
                  </span>
                {%- else -%}
                  {% comment %} radio button {% endcomment %}
                  <span class="radio__button">
                    <input
                      type="radio"
                      class="radio__input"
                      data-single-option-selector
                      data-index="option{{ option.position }}"
                      name="options[{{ option.name | escape_once }}]"
                      value="{{ value | escape_once }}" id="{{ input_id }}"
                      {% if value == current_value %}checked{% endif %}>
                    <label for="{{ input_id }}" class="radio__label">
                      <span>{{ value | escape_once }}</span>
                    </label>
                  </span>
                {%- endif -%}

              {%- endfor -%}
            </fieldset>
          {%- else -%}
            {%- assign selects_counter = selects_counter | plus: 1 -%}
            <div class="select__fieldset">
              {%- capture input_id -%}{{ product.id }}-option-{{ option.position }}{%- endcapture -%}
              <div class="select__label" id="{{ unique }}-select-{{ option.name | handle }}-label">
                {{- option.name | escape_once -}}
              </div>

              <div class="select-popout" data-popout data-popout-prevent="true">
                <button type="button" class="select-popout__toggle" aria-expanded="false" aria-controls="{{ unique }}-select-{{ option.name | handle }}" aria-labelledby="{{ unique }}-select-{{ option.name | handle }}-label" data-popout-toggle>
                  <span class="select-popout__value" data-popout-text>{{ option.selected_value }}</span>
                  {%- render 'icon-select' -%}
                </button>

                <div id="{{ unique }}-select-{{ option.name | handle }}" class="select-popout__list" data-popout-list>
                  <ul class="select-popout__list__scroll">
                    {%- for value in option.values -%}
                      <li class="select-popout__item {% if option.selected_value == value %}select-popout__item--current{% endif %}">
                        <a class="select-popout__option" href="#" {% if option.selected_value == value %}aria-current="true"{% endif %} data-value="{{ value | escape_once }}" data-popout-option>
                          <span>
                            {{ value | escape_once }}
                          </span>
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
                <input type="hidden" name="options[{{ option.name | escape_once }}]" id="{{ input_id }}" value="{{ option.selected_value | escape_once }}" data-popout-input data-single-option-selector data-index="option{{ option.position }}"/>
              </div>
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  {%- endunless -%}
{%- endcapture -%}

            {{- form_fields -}}

            <noscript>
              <select
                name="id"
                class="product__form__select"
                aria-label="{{ product.options_with_values | map: 'name' | uniq | join: ', ' }}"
              >
                {%- for variant in product.variants -%}
                  <option
                    {% if variant == current_variant %}
                      selected="selected"
                    {% endif %}
                    {% unless variant.available %}
                      disabled="disabled"
                    {% endunless %}
                    value="{{ variant.id }}"
                  >
                    {{- variant.title -}}
                  </option>
                {%- endfor -%}
              </select>
            </noscript>

            {%- if product.selling_plan_groups.size > 0 -%}
              {%- if enable_subscriptions_selectors -%}
                {%- render 'subscription-form',
                  product: product,
                  animations_enabled: animations_enabled,
                  animation_anchor: animation_anchor,
                  animation_delay: animation_delay
                -%}
              {%- endif -%}
              {%- assign animation_delay = animation_delay | plus: 100 -%}
              {%- comment -%} Delete the following line to block the theme from updating subscription prices {%- endcomment -%}
              <span data-subscription-watch-price></span>
            {%- endif -%}

            {%- if show_quantity -%}
              <div
                class="selector-wrapper selector-wrapper--qty"
                {% if animations_enabled %}
                  data-aos="fade-up"
                  data-aos-anchor="{{ animation_anchor }}"
                  data-aos-delay="{{ animation_delay }}"
                  {%- assign animation_delay = animation_delay | plus: 100 -%}
                {% endif %}
              >
                {{ quantity_selector }}
              </div>
            {%- endif -%}

            {%- assign sold_out_text = 'products.product.sold_out' | t -%}
          </div>
        </div>
      </div>

      <div class="popup-quick-view__foot">
        {%- comment -%} We need the "foot__inner" container to avoid the vertical scroll that appears when animating the foot element {%- endcomment -%}
        <div class="popup-quick-view__foot__inner" data-quick-view-foot-inner>
          {%- comment -%} Product Form Buttons {%- endcomment -%}
          <!-- /partials/product-form-quickview-actions.liquid -->

          <div
            class="product__submit__holder{% if show_payment_button %} product__submit__holder--spb{% endif %}"
            data-product-id="{{ product.id }}"
          >
            <div class="product__submit__buttons">
              <div
                class="product__submit__item"
                {% if animations_enabled %}
                  data-aos="fade-up"
                  data-aos-anchor="{{ animation_anchor }}"
                  data-aos-delay="{{ animation_delay }}"
                  {%- assign animation_delay = animation_delay | plus: 150 -%}
                {% endif %}
              >
                <button
                  type="submit"
                  name="add"
                  id="AddToCart--{{ unique }}"
                  class="btn btn--submit product__submit__add"
                  data-add-to-cart
                  data-focus-element
                >
                  <span data-add-to-cart-text>
                    {%- if current_variant.available and product.tags contains '_preorder' -%}
                      {{ 'products.product.preorder' | t }}
                    {%- elsif current_variant.available -%}
                      {{ 'products.product.add_to_cart' | t }}
                    {%- else -%}
                      {{ sold_out_text }}
                    {%- endif -%}
                  </span>

                  <div class="loader loader--line"><div class="loader-indeterminate"></div></div>
                </button>
              </div>

              {%- if show_payment_button -%}
                <div
                  class="product__submit__item{% if sold_out %} hidden{% endif %}"
                  data-buy-it-now
                  {% if animations_enabled %}
                    data-aos="fade-up"
                    data-aos-anchor="{{ animation_anchor }}"
                    data-aos-delay="{{ animation_delay }}"
                    {%- assign animation_delay = animation_delay | plus: 100 -%}
                  {% endif %}
                >
                  {{ form | payment_button }}
                </div>
              {%- endif -%}
            </div>

            <div data-cart-errors-container class="product__form__errors"></div>
          </div>

          <a class="popup-quick-view__view-button popup-quick-view__view-button--desktop" href="{{ product_url }}">
            {{- 'products.general.view_all_details' | t -}}
          </a>
        </div>
      </div>
    </div>
  {%- endform -%}

  <script type="application/json" id="ProductJson-{{ unique }}" data-product-json>
    {{ product | json }}
  </script>
  <script type="application/json" id="ModelJson-{{ unique }}">
    {{ product.media | where: 'media_type', 'model' | json }}
  </script>
{%- else -%}
  {%- render 'product-quick-view-form-onboarding',
    unique: unique,
    product_url: product_url,
    product_title: product_title,
    product_gallery: product_gallery,
    quickview_form_classes: quickview_form_classes,
    quick_view_nav: quick_view_nav,
    hide_labels_class: hide_labels_class,
    animation_anchor: animation_anchor,
    animation_delay: animation_delay
  -%}
{%- endif -%}

{%- unless multiple_quick_view_items -%}
  </div>
  </div>
{%- endunless -%}
{%- endunless -%}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
// // Function to check if the target is in the viewport
// function isInViewport(element) {
//   var rect = element[0].getBoundingClientRect();
//   return (
//     rect.top >= 0 &&
//     rect.left >= 0 &&
//     rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
//     rect.right <= (window.innerWidth || document.documentElement.clientWidth)
//   );
// }

// let debounceTimer;

// $(window).on('scroll', function () {
// clearTimeout(debounceTimer); // Clear any previous timer

// debounceTimer = setTimeout(function () {
//   requestAnimationFrame(function () {
//     $('#lma__submit__holder').each(function () {
//       var $button = $('.product__submit__buttons');
//       if (isInViewport($(this))) {
//         // Smoothly remove class when in viewport
//         $button.removeClass('lma_btn_submit');
//       } else {
//         // Smoothly add class when out of viewport
//         $button.addClass('lma_btn_submit');
//       }
//     });
//   });
// }, 50); // Adjust this debounce delay as necessary
// });

// Create the observer  
const observer = new IntersectionObserver((entries) => {  
  entries.forEach(entry => {  
    const $button = $('.product__submit__buttons');  
    const $interactObserver = $('#interact-observer'); // Select the #interact-observer element  

    // Calculate the height of .product__submit__buttons  
    const buttonHeight = $button.outerHeight(); // Use outerHeight to include padding/borders  

    // Clear the existing timeout if it's already set  
    if (entry.isIntersecting) {  
      setTimeout(() => {  
        // Remove the classes after a delay when the element is back in the viewport  
        $button.removeClass('slide-in lma_btn_submit');  
        $interactObserver.css('height', ''); // Reset height when in viewport  
      }, 1); // Adjust this delay as needed (currently 30ms)  
    } else {  
      setTimeout(() => {  
        // Add the classes after a delay when the element is not in the viewport  
        $button.addClass('slide-in lma_btn_submit');  
        $interactObserver.css('height', buttonHeight + 'px'); // Set height to match button height when not in viewport  
      }, 300); // Adjust this delay as needed (currently 300ms)  
    }  
  });  
}, {  
  root: null,  // Default viewport  
  threshold: [0.1, 0.5, 0.9],  // Trigger when 10% of the element is in the viewport  
});  

// Target the element to observe  
const element = document.querySelector('#interact-observer');  
observer.observe(element);



document.addEventListener('DOMContentLoaded', function () {
  const checkInterval = 100; // Check every 100 milliseconds
  const timeout = 1000; // Stop checking after 5000 milliseconds (5 seconds)
  let elapsedTime = 0;

  const intervalId = setInterval(() => {
    const hasVariantsFromApp = document.querySelector('.ymq-options-box');
    if (hasVariantsFromApp || elapsedTime >= timeout) {
      clearInterval(intervalId); // Stop checking

      const lmaSubmitHolders = document.querySelectorAll('#lma__submit__holder');
      lmaSubmitHolders.forEach((lmaSubmitHolder) => {
        if (hasVariantsFromApp) {
          lmaSubmitHolder.classList.add('lma_has_variant');
        } else {
          lmaSubmitHolder.classList.add('lma_has_no_variant');
        }
      });
    }

    elapsedTime += checkInterval;
  }, checkInterval);
});
</script>

<style>
  /* Fade-in animation */
.fade-in {
  opacity: 0;
  animation: fadeInAnimation 0.5s ease-in-out forwards;
}

@keyframes fadeInAnimation {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Slide-in animation from bottom */
.slide-in {
  transform: translateY(100px); /* Start below the viewport */
  opacity: 0;
  animation: slideInAnimation 0.5s ease-in-out forwards;
}

@keyframes slideInAnimation {
  from {
    transform: translateY(100px); /* Start below */
    opacity: 0;
  }
  to {
    transform: translateY(0); /* Slide up */
    opacity: 1;
  }
}

  /* Slide-out animation (reverse of slide-in) */
.slide-out {
  transform: translateY(100px); /* Slide it back down */
  opacity: 0;
  transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out;
}
  
.lma_has_no_variant .product__submit__buttons .product_price_section {
  display: none;
}

.lma_has_no_variant .product__submit__buttons {
  padding: 0px !important;
}

#lma__submit__holder.lma_has_no_variant {
  padding-inline: 0px;
  background: white;
}

.lma_has_no_variant .lma_estimated_delivery_date {
  margin-left: 0px !important;
}

.product__submit__buttons.lma-is-sold-out {
  justify-content: start !important;
  align-items: center;
  gap: 10px;
}

.lma_has_variant .product__submit__buttons.lma-is-sold-out {
  flex-direction: column;
  align-items: start;
  gap: 10px;
}

.lma_has_variant .product__submit__buttons.lma-is-sold-out .product__submit__item {
  width: 100%;
  max-width: 100% !important;
}

.lma_has_variant .product__submit__buttons .lma-sold-out-section .ymq-price-span {
  color: #86888a !important;
  font-weight: 700;
}
. .lma-sold-out-section .product__price {
  display: none;
}

.lma_has_variant .lma-sold-out-section .product__price {
  display: flex;
}

.lma_has_variant .lma-sold-out-section {
  display: flex;
  align-items: center;
  gap: 4px;
}
</style>
